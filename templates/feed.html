<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Feed</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <nav>
      <a href="{{ url_for('feed') }}">Feed</a> |
      <a href="{{ url_for('perfil', apelido=current_user.apelido) }}">Perfil</a>
      |
      <a href="{{ url_for('logout') }}">Sair</a>
    </nav>
    <hr />

    <h2>Feed</h2>

    <form method="POST" action="{{ url_for('feed') }}">
      {{ form.hidden_tag() }}
      <p>{{ form.body(rows=3, cols=60) }}</p>
      <p>{{ form.submit() }}</p>
    </form>

    <hr />

    {% for post in posts %}
    <div class="post">
      <p>
        <strong
          ><a href="{{ url_for('perfil', apelido=post.author.apelido) }}"
            >{{ post.author.apelido }}</a
          ></strong
        >
        - {{ post.timestamp.strftime('%d/%m/%Y %H:%M') }}
      </p>
      <p>{{ post.body }}</p>
      <form method="POST" action="{{ url_for('like', post_id=post.id) }}">
        <button type="submit">
          {% set liked = false %} {% for like in post.likes %} {% if
          like.user_id == current_user.id %} {% set liked = true %} {% endif %}
          {% endfor %} {{ "Descurtir" if liked else "Curtir" }}
        </button>
      </form>
      <a href="{{ url_for('edit_post', post_id=post.id) }}">Editar</a>

      <div class="comments">
        <h4>Coment√°rios</h4>
        {% for comment in post.comments.order_by('timestamp desc') %}
        <p><strong>{{ comment.author.apelido }}</strong>: {{ comment.body }}</p>
        {% endfor %}
        <form method="POST" action="{{ url_for('comment', post_id=post.id) }}">
          {{ comment_forms[post.id].hidden_tag() }} {{
          comment_forms[post.id].body(rows=2, cols=50) }} {{
          comment_forms[post.id].submit() }}
        </form>
      </div>
    </div>
    <hr />
    {% endfor %}
  </body>
</html>
